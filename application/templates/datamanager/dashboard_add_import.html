{% extends 'layouts/base.html' %}

{% from "govuk_frontend_jinja/components/button/macro.html" import govukButton %}
{% from "govuk_frontend_jinja/components/textarea/macro.html" import govukTextarea %}
{% from "govuk_frontend_jinja/components/back-link/macro.html" import govukBackLink %}

{% block content %}
<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    {{ govukBackLink({
      'text': 'Back',
      'href': url_for('datamanager.dashboard_get')
    }) }}

    <h1 class="govuk-heading-xl">Import endpoint configuration</h1>

    <p class="govuk-body">
      Paste your import CSV data below (likley generated by provide platform). The CSV should include headers and a single row with the configuration details.
    </p>

    <details class="govuk-details" data-module="govuk-details">
      <summary class="govuk-details__summary">
        <span class="govuk-details__summary-text">
          CSV format example
        </span>
      </summary>
      <div class="govuk-details__text">
        <pre class="app-code-block">organisation,pipelines,documentation-url,endpoint-url,start-date,plugin,licence
local-authority:SKP,article-4-direction-area,https://www.stockport.gov.uk/planning-development-open-datasets,https://raw.githubusercontent.com/digital-land/PublishExamples/refs/heads/main/Article4Direction/Files/Article4DirectionArea/articel4directionareas-(wrongColName-NewRefs).csv,2026-01-22,,ogl3</pre>
      </div>
    </details>

    {% if errors.get('csv_data') %}
    <div class="govuk-error-summary" role="alert" data-module="govuk-error-summary">
      <h2 class="govuk-error-summary__title">There is a problem</h2>
      <div class="govuk-error-summary__body">
        <ul class="govuk-list govuk-error-summary__list">
          <li><a href="#csv-data">{{ errors.csv_data }}</a></li>
        </ul>
      </div>
    </div>
    {% endif %}

    <form method="post" action="{{ url_for('datamanager.dashboard_add_import') }}">
      <input type="hidden" name="mode" value="parse">

      <div class="govuk-form-group {% if errors.get('csv_data') %}govuk-form-group--error{% endif %}">
        <label class="govuk-label govuk-label--m" for="csv-data">
          CSV data
        </label>
        <div id="csv-data-hint" class="govuk-hint">
          Include the header row and one data row
        </div>
        {% if errors.get('csv_data') %}
        <p class="govuk-error-message">
          <span class="govuk-visually-hidden">Error:</span> {{ errors.csv_data }}
        </p>
        {% endif %}
        <textarea 
          class="govuk-textarea {% if errors.get('csv_data') %}govuk-textarea--error{% endif %}" 
          id="csv-data" 
          name="csv_data" 
          rows="8"
          aria-describedby="csv-data-hint"
        >{{ csv_data }}</textarea>
      </div>

      {{ govukButton({
        'text': 'Parse CSV',
        'attributes': { 'id': 'parse-button' }
      }) }}
    </form>

  </div>
</div>
{% endblock %}

{% block pageScripts %}
<style>
  .app-code-block {
    background-color: #f3f2f1;
    border: 1px solid #b1b4b6;
    padding: 15px;
    overflow-x: auto;
    font-family: monospace;
    font-size: 14px;
    line-height: 1.5;
  }
</style>
{% endblock %}
